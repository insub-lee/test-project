server {
    listen 80;
    server_name 127.0.0.1;
    client_max_body_size 1000M;

    location ~ /eventbus/ {
            proxy_pass              http://portal-sockjs;
            proxy_http_version      1.1;
            proxy_set_header       Upgrade $http_upgrade;
            proxy_set_header       Connection "upgrade";
    }

    location ~ ^(/api/common/v1/auth) {
            proxy_pass  http://portal-auth;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;

            # Headers for client browser NOCACHE
            #add_header 'Cache-Control' 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
            #expires off;
    }
    
        location ~ ^(/api/common/v1/auth/login) {
            proxy_pass  http://portal-auth;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;

            # Headers for client browser NOCACHE
            #add_header 'Cache-Control' 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
            #expires off;
    }

    location ~ ^(/oauth/) {
            proxy_pass  http://portal-oauth;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;

            # Headers for client browser NOCACHE
            #add_header 'Cache-Control' 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
            #expires off;
    }

    location ~ ^(/api/common/v1/account) {
            proxy_pass  http://portal-account;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
     }

    location ~ ^(/api/bizstore/v1/store) {
            proxy_pass  http://portal-appstore;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/bizstore/v1/mypage) {
            proxy_pass  http://portal-mypage;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/portal/v1/dock) {
            proxy_pass  http://portal-dock;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/bizstore/v1/bizgroup) {
            proxy_pass  http://portal-bizgroup;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/portal/v1/page) {
            proxy_pass  http://portal-page;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/admin/v1/common) {
            proxy_pass  http://portal-admin;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/common/v1/notify) {
            proxy_pass  http://common-notify;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/bizstore/v1/appmanage) {
            proxy_pass  http://portal-appmanage;
            proxy_connect_timeout 60;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/common/v1/migration) {
            proxy_pass  http://portal-migration;
            #proxy_connect_timeout 1800;
            proxy_read_timeout      1800; # default 60
            proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }    

    location ~ ^(/api/common/v1/filemanage) {
            proxy_pass  http://portal-filemanage;
		    proxy_connect_timeout 60;
            proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }  

    location ~ ^(/api/builder/v1/work) {
           proxy_pass  http://builder-common;
           proxy_connect_timeout 60;
           proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
           proxy_set_header     user_agent $http_user_agent;
           proxy_set_header     referer $http_referer;
           proxy_set_header     host $http_host;
    }

    location ~ ^(/api/workflow/v1/common) {
           proxy_pass  http://workflow-common;
           proxy_connect_timeout 60;
           proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
           proxy_set_header     user_agent $http_user_agent;
           proxy_set_header     referer $http_referer;
           proxy_set_header     host $http_host;
    }

    location ~ ^(/api/manual/v1/) {
            proxy_pass  http://manual-common;
            proxy_connect_timeout 10;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/mdcs/v1/common) {
            proxy_pass  http://mdcs-common;
            proxy_connect_timeout 10;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/edds/v1/common) {
            proxy_pass  http://edds-common;
            proxy_connect_timeout 10;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/eshs/v1/common/) {
            proxy_pass  http://eshs-common;
            proxy_connect_timeout 10;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/migration/v1/common/) {
            proxy_pass  http://migration-common;
            #proxy_connect_timeout 1800;
            proxy_read_timeout      1800; # default 60
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/wts/v1/common/) {
            proxy_pass  http://wts-common;
            #proxy_connect_timeout 1800;
            proxy_read_timeout      1800; # default 60
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }
    
    location ~ ^(/api/gcs/v1/common/) {
            proxy_pass  http://gcs-common;
            #proxy_connect_timeout 1800;
            proxy_read_timeout      1800; # default 60
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/api/mxlife/v1/common) {
            proxy_pass  http://mxlife-common;
            proxy_connect_timeout 10;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }
    
    location ~ ^(/api/jem/) {
            proxy_pass  http://jem-common;
            proxy_connect_timeout 10;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }
    
    location ~ ^(/apigate/v1/portal/) {
            proxy_pass  http://tpms-common;
            proxy_connect_timeout 10;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^(/apigate/v1/portal) {
            proxy_pass  http://mxlife-common;
            proxy_connect_timeout 10;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
            proxy_set_header     user_agent $http_user_agent;
            proxy_set_header     referer $http_referer;
            proxy_set_header     host $http_host;
    }

    location ~ ^/img/thumb/crop/(.*)/(.*)$ {
        proxy_pass http://thumbor/unsafe/$1/http://prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:40033/down/thumb/$2;
        proxy_connect_timeout 60;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
        proxy_set_header     user_agent $http_user_agent;
        proxy_set_header     referer $http_referer;
        proxy_set_header     host $http_host;
        proxy_set_header     ID $2;

    }

    location ~ ^/img/thumb/(.*)/(.*)$ {
        proxy_pass http://thumbor/unsafe/fit-in/$1/filters:fill(auto)/http://prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:40033/down/thumb/$2;
        proxy_connect_timeout 60;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
        proxy_set_header     user_agent $http_user_agent;
        proxy_set_header     referer $http_referer;
        proxy_set_header     host $http_host;
        proxy_set_header     ID $2;
    }


    location /upload {
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '*';
            #add_header 'Access-Control-Allow-Credentials' 'true';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';
            add_header 'Access-Control-Max-Age' 1728000;
            add_header 'Content-Type' 'text/plain charset=UTF-8';
            add_header 'Content-Length' 0;
            return 204;
        }
        proxy_pass  http://portal-upload;
        proxy_connect_timeout 60;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
        proxy_set_header     user_agent $http_user_agent;
        proxy_set_header     referer $http_referer;
        proxy_set_header     host $http_host;
    }

    location /down {
        if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        #add_header 'Access-Control-Allow-Credentials' 'true';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain charset=UTF-8';
        add_header 'Content-Length' 0;
        return 204;
        }
        proxy_pass  http://portal-download;
        proxy_connect_timeout 60;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
        proxy_set_header     user_agent $http_user_agent;
        proxy_set_header     referer $http_referer;
        proxy_set_header     host $http_host;
    }
    
    # App Download
    location ~ /install/app/ {
        proxy_pass http://dev-biz-app.marathon.l4lb.thisdcos.directory:80;
    }

    location / {
            root  /usr/share/nginx/html;
            index index.html index.htm;
            try_files $uri $uri/ /index.html;

            add_header 'Cache-Control' 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
            expires off;
    }

    location /static/ {
            alias /usr/share/nginx/html/static/;

            expires 1y;
            add_header Cache-Control public;
    }

    location /css/fonts/ {
            alias /usr/share/nginx/html/css/fonts/;

            expires 1y;
            add_header Cache-Control public;
    }    
    
    #error_page  404         = @notfound;
    #error_page  500 502 504 = @server_error;
    #error_page  503         = @maintenance;

    location @notfound {
            root  C:/Users/goodrhys/git/neo-intelligence-flow-ui/build;
            try_files /404.html /../default/404.html =404;
    }

    location @server_error {
            root  C:/Users/goodrhys/git/neo-intelligence-flow-ui/build;
            try_files /500.html /../default/500.html =500;
    }

     location @maintenance {
            root  C:/Users/goodrhys/git/neo-intelligence-flow-ui/build;
            try_files /503.html /../default/503.html =503;
    }

}

# 외부 다운로드 링크 테스트
server {
	listen 80;
	server_name directdn.magnachip.com;
	client_max_body_size 1000M;
	
	location /share {
        proxy_pass  http://portal-download;
        proxy_connect_timeout 60;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Real-IP $proxy_add_x_forwarded_for;
        proxy_set_header     user_agent $http_user_agent;
        proxy_set_header     referer $http_referer;
        proxy_set_header     host $http_host;
	}
	
	location / {
		return 307 https://www.magnachip.com;
		#return 404;
	}
}


upstream portal-sockjs {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:17000;
}
upstream portal-auth {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10001;
}
upstream portal-oauth {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10015;
}
upstream portal-account {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10002;
}
upstream portal-appstore {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10008;
}
upstream portal-dock {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10004;
}
upstream portal-mypage {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10009;
}
upstream portal-bizgroup {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10007;
}
upstream portal-page {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10005;
}
upstream portal-admin {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10101;
}
upstream common-notify {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10003;
}
upstream portal-appmanage {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10006;
}
upstream builder-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10188;
}
upstream workflow-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10301;
}
upstream mdcs-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10400;
}
upstream edds-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10401;
}
upstream manual-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10500;
}
upstream eshs-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10510;
}
upstream migration-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10012;
}
upstream portal-download {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:40033;
}
upstream portal-upload {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:40032;
}
upstream portal-migration {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10011;
}
upstream portal-filemanage {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10013;
}
upstream wts-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10801;
}
upstream gcs-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10810;
}
upstream mxlife-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10710;
}
upstream tpms-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:10910;
}
upstream jem-common {
    server prod-bizmicro-portal.marathon.l4lb.thisdcos.directory:18082;
}
upstream thumbor {
    server prod-biz-thumbor.marathon.l4lb.thisdcos.directory:8000;
}
